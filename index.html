<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kho H·ªôi Tho·∫°i Song Ng·ªØ</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f5f5f5;
          color: #333;
      }
      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
          background-color: #2c3e50;
          color: white;
          padding: 20px 0;
          margin-bottom: 30px;
      }
      h1 {
          text-align: center;
      }
      .controls {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-bottom: 20px;
      }
      .search-box {
          width: 100%;
          padding: 12px;
          font-size: 16px;
          border: 2px solid #ddd;
          border-radius: 4px;
          margin-bottom: 15px;
      }
      .filters {
          display: flex;
          gap: 15px;
          flex-wrap: wrap;
      }
      select {
          padding: 8px 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
      }
      .add-btn {
          background-color: #3498db;
          color: white;
          padding: 10px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
      }
      .add-btn:hover {
          background-color: #2980b9;
      }
      .topic-tabs {
          display:flex;
          gap:16px;
          margin-bottom:20px;
          overflow-x:auto;
      }
      .topic-tabs::-webkit-scrollbar { display: none; }
      .topic-tab-btn {
          padding:8px 20px;
          border:none;
          border-radius:20px;
          background:#2c3e50;
          color:white;
          cursor:pointer;
          opacity:0.7;
          transition: opacity 0.2s;
      }
      .topic-tab-btn.active, .topic-tab-btn:focus {
          opacity:1;
          outline: none;
      }
      .topic-tab-btn[data-topic="business"] { background:#e74c3c; }
      .topic-tab-btn[data-topic="travel"] { background:#3498db; }
      .topic-tab-btn[data-topic="daily"] { background:#27ae60; }
      .topic-tab-btn[data-topic="education"] { background:#f39c12; }
      .conversations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(700px, 1fr));
        gap: 20px;
      }
      .conversation-card {
          background: white;
          border-radius: 8px;
          padding: 20px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          transition: transform 0.2s;
      }
      .conversation-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      }
      .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
      }
      .card-title {
          font-size: 18px;
          font-weight: bold;
          color: #2c3e50;
      }
      .topic-badge {
          background-color: #e74c3c;
          color: white;
          padding: 4px 12px;
          border-radius: 20px;
          font-size: 12px;
      }
      .level-badge {
          background-color: #f39c12;
          color: white;
          padding: 4px 12px;
          border-radius: 20px;
          font-size: 12px;
          margin-left: 8px;
      }
      .characters {
          display: flex;
          justify-content: space-between;
          margin-bottom: 15px;
          padding: 10px;
          background-color: #ecf0f1;
          border-radius: 4px;
      }
      .character {
          text-align: center;
          font-weight: bold;
          color: #2c3e50;
      }
      .character-a {
          color: #3498db;
      }
      .character-b {
          color: #e74c3c;
      }
      .dialogue-container {
          max-height: 400px;
          overflow-y: auto;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 15px;
      }
      .dialogue-line {
          margin-bottom: 15px;
          padding: 12px;
          border-radius: 8px;
          position: relative;
      }
      .dialogue-a {
          background-color: #e3f2fd;
          border-left: 4px solid #3498db;
          margin-right: 20px;
      }
      .dialogue-b {
          background-color: #ffebee;
          border-left: 4px solid #e74c3c;
          margin-left: 20px;
      }
      .speaker-name {
          font-weight: bold;
          font-size: 14px;
          margin-bottom: 5px;
      }
      .speaker-a {
          color: #3498db;
      }
      .speaker-b {
          color: #e74c3c;
      }
      .dialogue-content {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 10px;
      }
      .lang-text {
          padding: 8px;
          border-radius: 4px;
          line-height: 1.4;
      }
      .english-text {
          background-color: rgba(255,255,255,0.7);
          border: 1px solid #ddd;
      }
      .vietnamese-text {
          background-color: rgba(255,255,255,0.7);
          border: 1px solid #ddd;
          font-style: italic;
      }
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          z-index: 1000;
      }
      .modal-content {
          background: white;
          width: 90%;
          max-width: 1100px;
          margin: 30px auto;
          padding: 40px;
          border-radius: 8px;
          position: relative;
          max-height: 90vh;
          overflow-y: auto;
      }
      .close-btn {
          position: absolute;
          top: 10px;
          right: 15px;
          font-size: 28px;
          cursor: pointer;
          color: #999;
      }
      .form-group {
          margin-bottom: 20px;
      }
      .form-group label {
          display: block;
          margin-bottom: 5px;
          font-weight: bold;
      }
      .form-group input, .form-group textarea, .form-group select {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
      }
      .character-names {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 15px;
      }
      .dialogue-input {
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 15px;
          margin-bottom: 15px;
      }
      .dialogue-inputs {
          max-height: 300px;
          overflow-y: auto;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 15px;
          margin-bottom: 15px;
      }
      .add-dialogue-btn {
          background-color: #27ae60;
          color: white;
          padding: 8px 15px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          margin-bottom: 10px;
      }
      .remove-dialogue-btn {
          background-color: #e74c3c;
          color: white;
          padding: 4px 8px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 12px;
          float: right;
      }
      .speaker-select {
          width: 100px;
          margin-bottom: 10px;
      }
      .dialogue-texts {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 10px;
      }
      .submit-btn {
          background-color: #27ae60;
          color: white;
          padding: 12px 30px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
          width: 100%;
      }
      .submit-btn:hover {
          background-color: #229954;
      }
      .card-actions {
          margin-top: 10px;
          text-align: right;
      }
      .edit-btn {
          background: #f39c12;
          color: white;
          border: none;
          padding: 6px 12px;
          border-radius: 4px;
          cursor: pointer;
          margin-right: 8px;
      }
      .delete-btn {
          background: #e74c3c;
          color: white;
          border: none;
          padding: 6px 12px;
          border-radius: 4px;
          cursor: pointer;
          margin-right: 8px;
      }
      .duplicate-btn {
          background: #2980b9;
          color: white;
          border: none;
          padding: 6px 12px;
          border-radius: 4px;
          cursor: pointer;
      }
  </style>
</head>
<body>
  <header>
      <div class="container">
          <h1>üìö Kho H·ªôi Tho·∫°i Song Ng·ªØ</h1>
      </div>
  </header>
  
  <div class="container">
      <div class="controls">
          <input type="text" class="search-box" id="searchBox" placeholder="T√¨m ki·∫øm h·ªôi tho·∫°i...">
          
          <div class="filters">
              <select id="topicFilter">
                  <option value="">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
                  <option value="business">Business</option>
                  <option value="travel">Travel</option>
                  <option value="daily">Daily Life</option>
                  <option value="education">Education</option>
              </select>
              
              <select id="levelFilter">
                  <option value="">T·∫•t c·∫£ c·∫•p ƒë·ªô</option>
                  <option value="beginner">Beginner</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="advanced">Advanced</option>
              </select>
              
              <button class="add-btn" onclick="openModal()">+ Th√™m h·ªôi tho·∫°i m·ªõi</button>
          </div>
      </div>

      <!-- Topic Tabs -->
      <div class="topic-tabs">
          <button class="topic-tab-btn active" data-topic="">T·∫•t c·∫£</button>
          <button class="topic-tab-btn" data-topic="business">Business</button>
          <button class="topic-tab-btn" data-topic="travel">Travel</button>
          <button class="topic-tab-btn" data-topic="daily">Daily Life</button>
          <button class="topic-tab-btn" data-topic="education">Education</button>
      </div>
      
      <div class="conversations-grid" id="conversationsGrid">
          <!-- Cards s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
      </div>
  </div>
  
  <!-- Modal for adding/editing conversation -->
  <div id="addModal" class="modal">
      <div class="modal-content">
          <span class="close-btn" onclick="closeModal()">&times;</span>
          <h2>Th√™m h·ªôi tho·∫°i m·ªõi</h2>
          
          <form id="conversationForm">
              <div class="form-group">
                  <label>Ti√™u ƒë·ªÅ:</label>
                  <input type="text" id="title" required>
              </div>
              
              <div class="form-group">
                  <label>Ch·ªß ƒë·ªÅ:</label>
                  <select id="topic" required>
                      <option value="business">Business</option>
                      <option value="travel">Travel</option>
                      <option value="daily">Daily Life</option>
                      <option value="education">Education</option>
                  </select>
              </div>
              
              <div class="form-group">
                  <label>C·∫•p ƒë·ªô:</label>
                  <select id="level" required>
                      <option value="beginner">Beginner</option>
                      <option value="intermediate">Intermediate</option>
                      <option value="advanced">Advanced</option>
                  </select>
              </div>
              
              <div class="form-group">
                  <label>T√™n nh√¢n v·∫≠t:</label>
                  <div class="character-names">
                      <input type="text" id="characterA" placeholder="Nh√¢n v·∫≠t A" required>
                      <input type="text" id="characterB" placeholder="Nh√¢n v·∫≠t B" required>
                  </div>
              </div>
              
              <div class="form-group">
                  <label>ƒêo·∫°n h·ªôi tho·∫°i:</label>
                  <button type="button" class="add-dialogue-btn" onclick="addDialogueLine()">+ Th√™m c√¢u tho·∫°i</button>
                  <div class="dialogue-inputs" id="dialogueInputs">
                      <!-- Dialogue lines will be added here -->
                  </div>
              </div>
              
              <button type="submit" class="submit-btn">L∆∞u h·ªôi tho·∫°i</button>
          </form>
      </div>
  </div>
  
  <script>
      // M·∫∑c ƒë·ªãnh 2 h·ªôi tho·∫°i m·∫´u
      const defaultConversations = [
          {
              id: 1,
              title: "Meeting Introduction",
              topic: "business",
              level: "intermediate",
              characterA: "John (Manager)",
              characterB: "Sarah (New Employee)",
              dialogues: [
                  {speaker: "A", english: "Good morning everyone. Let's begin today's meeting.", vietnamese: "Ch√†o bu·ªïi s√°ng m·ªçi ng∆∞·ªùi. H√£y b·∫Øt ƒë·∫ßu cu·ªôc h·ªçp h√¥m nay."},
                  {speaker: "B", english: "Thank you for welcoming me to the team.", vietnamese: "C·∫£m ∆°n v√¨ ƒë√£ ch√†o ƒë√≥n t√¥i v√†o nh√≥m."},
                  {speaker: "A", english: "We're excited to have you here. Let's discuss today's agenda.", vietnamese: "Ch√∫ng t√¥i r·∫•t vui khi c√≥ b·∫°n ·ªü ƒë√¢y. H√£y th·∫£o lu·∫≠n v·ªÅ ch∆∞∆°ng tr√¨nh h√¥m nay."}
              ]
          },
          {
              id: 2,
              title: "At the Airport",
              topic: "travel",
              level: "beginner",
              characterA: "Tourist",
              characterB: "Staff",
              dialogues: [
                  {speaker: "A", english: "Excuse me, where is the check-in counter for Vietnam Airlines?", vietnamese: "Xin l·ªói, qu·∫ßy check-in c·ªßa Vietnam Airlines ·ªü ƒë√¢u?"},
                  {speaker: "B", english: "It's on the second floor, counter number 15-20.", vietnamese: "·ªû t·∫ßng hai, qu·∫ßy s·ªë 15-20 ·∫°."},
                  {speaker: "A", english: "Thank you very much!", vietnamese: "C·∫£m ∆°n b·∫°n r·∫•t nhi·ªÅu!"}
              ]
          }
      ];

      // Kh·ªüi t·∫°o d·ªØ li·ªáu
      let conversations = JSON.parse(localStorage.getItem('conversations'));
      if (!conversations || conversations.length === 0) {
          conversations = JSON.parse(JSON.stringify(defaultConversations));
          localStorage.setItem('conversations', JSON.stringify(conversations));
      }

      let dialogueCounter = 0;
      let editingConversationId = null;

      // Search/filter functionality
      document.getElementById('searchBox').addEventListener('input', filterConversations);
      document.getElementById('topicFilter').addEventListener('change', function(){
          // ƒê·ªìng b·ªô tab v√† filter
          let topic = this.value;
          document.querySelectorAll('.topic-tab-btn').forEach(btn=>{
              if(btn.dataset.topic===topic) btn.classList.add('active');
              else btn.classList.remove('active');
          });
          filterConversations();
      });
      document.getElementById('levelFilter').addEventListener('change', filterConversations);

      function filterConversations() {
          const searchTerm = document.getElementById('searchBox').value.toLowerCase();
          const topicFilter = document.getElementById('topicFilter').value;
          const levelFilter = document.getElementById('levelFilter').value;
          
          const cards = document.querySelectorAll('.conversation-card');
          
          cards.forEach(card => {
              const title = card.querySelector('.card-title').textContent.toLowerCase();
              const content = card.textContent.toLowerCase();
              const topic = card.dataset.topic;
              const level = card.dataset.level;
              
              const matchesSearch = content.includes(searchTerm);
              const matchesTopic = !topicFilter || topic === topicFilter;
              const matchesLevel = !levelFilter || level === levelFilter;
              
              if (matchesSearch && matchesTopic && matchesLevel) {
                  card.style.display = 'block';
              } else {
                  card.style.display = 'none';
              }
          });
      }

      // Topic tab click
      function setupTopicTabs() {
          document.querySelectorAll('.topic-tab-btn').forEach(btn => {
              btn.addEventListener('click', function() {
                  document.querySelectorAll('.topic-tab-btn').forEach(b => b.classList.remove('active'));
                  this.classList.add('active');
                  document.getElementById('topicFilter').value = this.dataset.topic;
                  filterConversations();
              });
          });
      }
      
      // Modal functions
      function openModal() {
          document.getElementById('addModal').style.display = 'block';
          // Add initial dialogue line
          if (document.getElementById('dialogueInputs').children.length === 0) {
              addDialogueLine();
          }
      }
      
      function closeModal() {
          document.getElementById('addModal').style.display = 'none';
          document.getElementById('conversationForm').reset();
          document.getElementById('dialogueInputs').innerHTML = '';
          dialogueCounter = 0;
          editingConversationId = null;
      }
      
      // Add dialogue line input
      function addDialogueLine() {
          const container = document.getElementById('dialogueInputs');
          const lineDiv = document.createElement('div');
          lineDiv.className = 'dialogue-input';
          lineDiv.innerHTML = `
              <button type="button" class="remove-dialogue-btn" onclick="removeDialogueLine(this)">X√≥a</button>
              <select class="speaker-select" name="speaker_${dialogueCounter}">
                  <option value="A">Nh√¢n v·∫≠t A</option>
                  <option value="B">Nh√¢n v·∫≠t B</option>
              </select>
              <div class="dialogue-texts">
                  <textarea name="english_${dialogueCounter}" placeholder="N·ªôi dung ti·∫øng Anh" required></textarea>
                  <textarea name="vietnamese_${dialogueCounter}" placeholder="N·ªôi dung ti·∫øng Vi·ªát" required></textarea>
              </div>
          `;
          container.appendChild(lineDiv);
          dialogueCounter++;
      }
      
      function removeDialogueLine(button) {
          button.parentElement.remove();
      }
      
      // Form submission (add/edit)
      document.getElementById('conversationForm').addEventListener('submit', function(e) {
          e.preventDefault();
          
          const title = document.getElementById('title').value;
          const topic = document.getElementById('topic').value;
          const level = document.getElementById('level').value;
          const characterA = document.getElementById('characterA').value;
          const characterB = document.getElementById('characterB').value;
          
          // Collect dialogue lines
          const dialogues = [];
          const dialogueInputs = document.querySelectorAll('.dialogue-input');
          
          dialogueInputs.forEach((input, index) => {
              const speaker = input.querySelector('select').value;
              const english = input.querySelector('textarea[name^="english"]').value;
              const vietnamese = input.querySelector('textarea[name^="vietnamese"]').value;
              
              dialogues.push({
                  speaker: speaker,
                  english: english,
                  vietnamese: vietnamese
              });
          });

          if (editingConversationId) {
              // Update
              const idx = conversations.findIndex(c => c.id === editingConversationId);
              if (idx !== -1) {
                  conversations[idx] = {
                      id: editingConversationId,
                      title, topic, level, characterA, characterB, dialogues
                  };
              }
              editingConversationId = null;
          } else {
              // Add new
              const newConversation = {
                  id: Date.now(),
                  title, topic, level, characterA, characterB, dialogues
              };
              conversations.push(newConversation);
          }
          localStorage.setItem('conversations', JSON.stringify(conversations));
          renderConversations();
          closeModal();
          alert('L∆∞u h·ªôi tho·∫°i th√†nh c√¥ng!');
      });

      // Th√™m h·ªôi tho·∫°i v√†o grid
      function addConversationCard(conversation) {
          const grid = document.getElementById('conversationsGrid');
          
          const card = document.createElement('div');
          card.className = 'conversation-card';
          card.dataset.topic = conversation.topic;
          card.dataset.level = conversation.level;
          
          const topicLabels = {
              business: 'Business',
              travel: 'Travel',
              daily: 'Daily Life',
              education: 'Education'
          };
          
          const levelLabels = {
              beginner: 'Beginner',
              intermediate: 'Intermediate',
              advanced: 'Advanced'
          };
          
          // Generate dialogue HTML
          let dialogueHTML = '';
          conversation.dialogues.forEach((dialogue, index) => {
              const isCharacterA = dialogue.speaker === 'A';
              const characterName = isCharacterA ? conversation.characterA : conversation.characterB;
              const dialogueClass = isCharacterA ? 'dialogue-a' : 'dialogue-b';
              const speakerClass = isCharacterA ? 'speaker-a' : 'speaker-b';
              
              dialogueHTML += `
                  <div class="dialogue-line ${dialogueClass}">
                      <div class="speaker-name ${speakerClass}">${characterName}:</div>
                      <div class="dialogue-content">
                          <div class="lang-text english-text">${dialogue.english}</div>
                          <div class="lang-text vietnamese-text">${dialogue.vietnamese}</div>
                      </div>
                  </div>
              `;
          });
          
          card.innerHTML = `
              <div class="card-header">
                  <h3 class="card-title">${conversation.title}</h3>
                  <div>
                      <span class="topic-badge">${topicLabels[conversation.topic]}</span>
                      <span class="level-badge">${levelLabels[conversation.level]}</span>
                  </div>
              </div>
              <div class="characters">
                  <div class="character character-a">üë§ ${conversation.characterA}</div>
                  <div class="character character-b">üë§ ${conversation.characterB}</div>
              </div>
              <div class="dialogue-container">
                  ${dialogueHTML}
              </div>
              <div class="card-actions">
                  <button class="edit-btn" onclick="editConversation(${conversation.id})">S·ª≠a</button>
                  <button class="delete-btn" onclick="deleteConversation(${conversation.id})">X√≥a</button>
                  <button class="duplicate-btn" onclick="duplicateConversation(${conversation.id})">Nh√¢n b·∫£n</button>
              </div>
          `;
          
          grid.appendChild(card);
      }

      // X√≥a h·ªôi tho·∫°i
      function deleteConversation(id) {
          if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a h·ªôi tho·∫°i n√†y?')) return;
          conversations = conversations.filter(conv => conv.id !== id);
          localStorage.setItem('conversations', JSON.stringify(conversations));
          renderConversations();
          filterConversations();
      }

      // S·ª≠a h·ªôi tho·∫°i
      function editConversation(id) {
          const conv = conversations.find(c => c.id === id);
          if (!conv) return;
          openModal();
          editingConversationId = id;

          document.getElementById('title').value = conv.title;
          document.getElementById('topic').value = conv.topic;
          document.getElementById('level').value = conv.level;
          document.getElementById('characterA').value = conv.characterA;
          document.getElementById('characterB').value = conv.characterB;

          // Clear and fill dialogue inputs
          const container = document.getElementById('dialogueInputs');
          container.innerHTML = '';
          dialogueCounter = 0;
          conv.dialogues.forEach(d => {
              const lineDiv = document.createElement('div');
              lineDiv.className = 'dialogue-input';
              lineDiv.innerHTML = `
                  <button type="button" class="remove-dialogue-btn" onclick="removeDialogueLine(this)">X√≥a</button>
                  <select class="speaker-select" name="speaker_${dialogueCounter}">
                      <option value="A"${d.speaker === 'A' ? ' selected' : ''}>Nh√¢n v·∫≠t A</option>
                      <option value="B"${d.speaker === 'B' ? ' selected' : ''}>Nh√¢n v·∫≠t B</option>
                  </select>
                  <div class="dialogue-texts">
                      <textarea name="english_${dialogueCounter}" placeholder="N·ªôi dung ti·∫øng Anh" required>${d.english}</textarea>
                      <textarea name="vietnamese_${dialogueCounter}" placeholder="N·ªôi dung ti·∫øng Vi·ªát" required>${d.vietnamese}</textarea>
                  </div>
              `;
              container.appendChild(lineDiv);
              dialogueCounter++;
          });
      }

      // Nh√¢n b·∫£n h·ªôi tho·∫°i
      function duplicateConversation(id) {
          let conv = conversations.find(c => c.id === id);
          if (!conv) return;
          // T·∫°o b·∫£n sao v·ªõi id m·ªõi
          let newConv = JSON.parse(JSON.stringify(conv));
          newConv.id = Date.now();
          newConv.title += " (B·∫£n sao)";
          conversations.push(newConv);
          localStorage.setItem('conversations', JSON.stringify(conversations));
          renderConversations();
          alert('ƒê√£ nh√¢n b·∫£n h·ªôi tho·∫°i!');
      }

      // Render l·∫°i danh s√°ch h·ªôi tho·∫°i (kh√¥ng c√≥ m·∫´u c·ª©ng)
      function renderConversations() {
          const grid = document.getElementById('conversationsGrid');
          grid.innerHTML = '';
          conversations.forEach(conv => {
              addConversationCard(conv);
          });
          filterConversations();
      }

      // Load saved conversations on page load
      window.addEventListener('load', function() {
          setupTopicTabs();
          renderConversations();
      });
      
      // Close modal when clicking outside
      window.onclick = function(event) {
          const modal = document.getElementById('addModal');
          if (event.target == modal) {
              closeModal();
          }
      }
      // Expose functions for inline event handlers
      window.openModal = openModal;
      window.closeModal = closeModal;
      window.addDialogueLine = addDialogueLine;
      window.removeDialogueLine = removeDialogueLine;
      window.editConversation = editConversation;
      window.deleteConversation = deleteConversation;
      window.duplicateConversation = duplicateConversation;
  </script>
</body>
</html>
